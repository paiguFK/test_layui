<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Demo</title>
    <!-- 请勿在项目正式环境中引用该 layui.css 地址 -->
    <link href="//unpkg.com/layui@2.9.13/dist/css/layui.css" rel="stylesheet" />
  </head>

  <body class="layui-padding-3">
    <div class="layui-tab layui-tab-card">
      <ul class="layui-tab-title">
        <li class="layui-this">标签1</li>
        <li lay-filter="add-depend-tab">新增依赖</li>
        <li>标签3</li>
        <li>标签4</li>
        <li>标签5</li>
      </ul>
      <div class="layui-tab-content">
        <div class="layui-tab-item layui-show">内容-1</div>
        <div
          class="layui-tab-item"
          lay-filter="add-depend-context"
          id="add-depend-context"
        >
          内容-2
        </div>
        <div class="layui-tab-item">内容-3</div>
        <div class="layui-tab-item">内容-4</div>
        <div class="layui-tab-item">内容-5</div>
      </div>
    </div>

    <!-- add-depend-context模板 -->
    <script id="temp-add-depend-form" type="text/html">
      <form
        class="layui-form layui-form-pane"
        action=""
        lay-filter="add-depend-form"
      >
        <div class="layui-form-item">
          <label class="layui-form-label" style="overflow: visible"
            >选择初始表格</label
          >
          <div class="layui-input-block">
            <select
              lay-search=""
              name="first-table-select"
              lay-filter="first-table-select"
            >
              <option value="">请选择或搜索</option>
              {{# layui.each(d, function(key, value){ }}
              <option value="{{key}}">{{key}}+{{value}}</option>
              {{# }) }}
            </select>
          </div>
        </div>
      </form>
    </script>

    <!-- alert-fields-secect模板 -->
    <script id="temp-alert-fields-secect" type="text/html">
      <div class="layui-form">
        {{# layui.each(d, function(key, value){ }}
        <input type="checkbox" name="{{key}}" title="{{value}}" lay-skin="tag" />
        {{# layui.each(d, function(key, value){ }}
      </div>
    </script>

    <!-- 请勿在项目正式环境中引用该 layui.js 地址 -->
    <script src="//unpkg.com/layui@2.9.13/dist/layui.js"></script>
    <script>
      // CurrentUnits中的方法暂时写在这
      layui.define(['jquery', 'form', 'layer'], function (exports) {
        var $ = layui.jquery;
        var form = layui.form;
        var layer = layui.layer;
        // 定义多个方法
        var CurrentUnits = {
          get_csv_name: function () {
            return {
              csv_en_name1: 'csv_cn_name1',
              csv_en_name2: 'csv_cn_name2',
            };
          },
          get_fields_data: function (select_data) {
            var csv_name = select_data['value'];
            var data = {
              csv_name: csv_name,
            };
            console.log(data);
            $.ajax({
              type: 'GET',
              url: 'https://jsonplaceholder.typicode.com/photos',
              dataType: 'json',
              success: function (response) {},
              error: function (xhr, status, error) {},
            });
          },
          on_table_select_change: function (table_name, open_alert) {
            var select_str = 'select(' + table_name + ')';
            form.on(select_str, function (data) {
              select_data = {
                text: null,
                value: null,
              };
              select_data['text'] = this.innerHTML;
              select_data['value'] = data.value;
              open_alert(select_data);
            });
          },
        };
        // 输出模块字段
        exports('CurrentUnits', CurrentUnits);
      });

      // AddDepend中的方法暂时写在这
      layui.define(
        ['jquery', 'form', 'layer', 'CurrentUnits'],
        function (exports) {
          var $ = layui.jquery;
          var form = layui.form;
          var layer = layui.layer;
          var units = layui.CurrentUnits;

          function render_fields_secect() {
            var temp_add_depend_form = document.getElementById(
              'temp-alert-fields-secect'
            ).innerHTML; // 获取模板字符
            // 渲染并输出结果
            laytpl(temp_add_depend_form).render(CSVNAMES, function (str) {
              add_depend_context.innerHTML = str;
            });
            // 只渲染filter为add-depend-form的form，第一个参数为elem的类型如select，不填则所有都渲染
            form.render(null, 'add-depend-form');
          }

          // 定义多个方法
          var AddDepend = {
            open_fields_alert: function (data) {
              units.get_fields_data();
              layer.open({
                type: 1,
                content: '<div style="padding: 16px;">任意 HTML 内容</div>',
              });
            },
          };
          // 输出模块字段
          exports('AddDepend', AddDepend);
        }
      );

      layui.use(['CurrentUnits', 'AddDepend'], function () {
        var laytpl = layui.laytpl;
        var form = layui.form;
        var $ = layui.jquery;
        var units = layui.CurrentUnits;
        var add_depend = layui.AddDepend;
        CSVNAMES = null;
        FIRST_TABLE = {
          text: null,
          value: null,
        };
        if (!CSVNAMES) {
          CSVNAMES = units.get_csv_name();
        }
        var temp_add_depend_form = document.getElementById(
          'temp-add-depend-form'
        ).innerHTML; // 获取模板字符
        var add_depend_context = document.getElementById('add-depend-context'); // 视图对象
        // 渲染并输出结果
        laytpl(temp_add_depend_form).render(CSVNAMES, function (str) {
          add_depend_context.innerHTML = str;
        });
        // 只渲染filter为add-depend-form的form，第一个参数为elem的类型如select，不填则所有都渲染
        form.render(null, 'add-depend-form');
        units.on_table_select_change(
          'first-table-select',
          add_depend.open_fields_alert
        );
      });
    </script>
  </body>
</html>
